!function(t){var e=function(t){if("undefined"!=typeof t){if(!t.hasOwnProperty("id"))throw new Error("i.js instances must have an id");if(this.id=t.id,!t.hasOwnProperty("template"))throw new Error("i.js instances must have a template");if(this.template=t.template,!t.hasOwnProperty("source"))throw new Error("i.js instances must have a source. This can be either a function, CSS selector, or PubNub stream");if(this.source=t.source,t.hasOwnProperty("hooks")&&(this.hooks=t.hooks),t.hasOwnProperty("capture")){if("string"!=typeof t.source)throw new Error("Only specify 'capture' when 'source' is a string containing an element selector and a method, e.g. 'click #<id>'");this.capture=t.capture}this.options=t}return this};t.I=new e,t.I.instances=[],t.i=function(s){var i=new e(s);return t.I.instances.push(i),i},e.prototype.init=function(t){var e=$("[i-"+t.id+"]");this.tokens=this.getTokens(this.template);var s={el:e,template:this.template,data:{}};if(!(this.tokens.length>0))throw new Error("Template must contain at least one variable declaration between double-braces, e.g. {{variable}}");this.tokens.map(function(e){t.hasOwnProperty("initWith")&&t.initWith.hasOwnProperty(e)?s.data[e]=t.initWith[e]:s.data[e]=""}),this.ractive=new Ractive(s),this.start()},e.prototype.id=null,e.prototype.pipes={},e.prototype.ractive=null,e.prototype.start=function(){var t=function(t){var e={};this.tokens.map(function(s){if(this.hasOwnProperty("capture")&&(t=$(this.capture).val()),this.hasOwnProperty("hooks")&&this.hooks.hasOwnProperty(s)&&(t=this.hooks[s](t)),"string"==typeof t)e[s]=t;else if(t instanceof Date)e[s]=t.toString();else if(s.indexOf(".")>0){var i=t;s.split(".").map(function(t){i=i[t]}),e[s]=i}else e[s]=t[s]}.bind(this)),this.set.call(this,e)};if("string"==typeof this.source){if(!this.hasOwnProperty("capture"))throw new Error("i.js instances using a CSS selector as source must also specify an element whose value to capture. They can be the same.");if(this.srcMethod=this.source.split(" ")[0],this.srcSelector=this.source.split(" ")[1],!this.srcSelector.match("#"))throw new Error("Class names are not supported for input sources. Please use an #<id>");var e=Rx.Observable.fromEvent($(this.srcSelector),this.srcMethod);this.subscription=e.subscribe(t.bind(this))}else{var e=Rx.Observable.create(function(t){if(this.observer=t,"function"==typeof this.source)this.source(this.send.bind(this));else if(this.source.hasOwnProperty("pubnub")){var e={},s={message:this.send.bind(this)};Object.keys(this.source.pubnub).map(function(t){"subscribe_key"===t&&(e.subscribe_key=this.source.pubnub.subscribe_key,delete this.source.pubnub.subscribe_key),"channel"===t&&(s[t]=this.source.pubnub.channel)}.bind(this)),PUBNUB.init(e).subscribe(s)}}.bind(this));this.subscription=e.subscribe(t.bind(this))}},e.prototype.send=function(t){this.srcSelector&&this.srcMethod?$(this.srcSelector)[this.srcMethod](t):this.observer.onNext(t)},e.prototype.set=function(t){this.tokens.map(function(e){setTimeout(function(){this.ractive.set(e,t[e])}.bind(this),0)}.bind(this))},e.prototype.asCallback=function(t){return function(t){this.observer.onNext(t)}.bind(t)},e.prototype.getTokens=function(t){for(var e,s=[],i=/{{([^}]+)}}/g;e=i.exec(t);)s.push(e[1]);return s}}(window),I.loadScript=function(t,e){var s=document.createElement("script");s.type="text/javascript",s.readyState?s.onreadystatechange=function(){("loaded"==s.readyState||"complete"==s.readyState)&&(s.onreadystatechange=null,e())}:s.onload=function(){e()},s.src=t,document.getElementsByTagName("head")[0].appendChild(s)},I.withPubNub=function(){I.instances.map(function(t){t.init(t.options),t.options=null})},I.withRx=function(){"undefined"==typeof PUBNUB?I.loadScript("http://cdn.pubnub.com/pubnub.min.js",I.withPubNub):I.withPubNub()},I.withRactive=function(){"undefined"==typeof Rx?I.loadScript("https://cdnjs.cloudflare.com/ajax/libs/rxjs/3.1.2/rx.all.min.js",I.withRx):I.withRx()},I.withJQuery=function(){"undefined"==typeof moment?I.loadScript("http://cdn.ractivejs.org/latest/ractive.js",I.withRactive):I.withRactive()},"undefined"==typeof $?I.loadScript("https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js",I.withJQuery):I.withJQuery();